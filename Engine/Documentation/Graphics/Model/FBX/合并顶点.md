# 合并顶点

## 合并顶点的目的
	
1. 降低冗余的顶点信息，如果两个顶点的信息完全一样（pos,normal,tangent,uv,boneweight,bones),仅仅通过Index就可以复用。
2. 因为在算tangent时要分裂顶点，所以最后一步要合并顶点；

## 顶点合并算法
见UE的skeletalMeshTools.cpp中的 BuildSkeletalMeshChunks()

### 算法思想
1. 查找顶点间的对应关系
2. 按照三角形顶点的顺序，一个一个添加顶点，如果在已经添加的顶点中有与当前顶点相同的顶点，则不在VB中添加当前顶点，并且在Index中添加已经存在的顶点的Index; 

### 算法实现（暴力）
1. 查找顶点间的对应关系0(n^2)
2. 三角形顺序添加o(n)

### UE实现
1. 查找顶点间对应关系
	1.1 首先通过Z值对顶点进行hash,建立相同Z值的顶点对应关系（如果Z不相同，肯定两个顶点不相同），保存在MutiMap RawVerts2Dupes中，
2. 按照三角形顶点顺序
	2.1 在RawVerts2Dupes中找到与当前顶点Z值一致的点，对顶点顺序排序，
    2.2  如果Z值一致的点的Index比当前值大，直接跳过(因为Index比当前值大说明该顶点肯定没有保存在最终VB中）；
	2.3 如果Z值一致的点的Index比当前值小，查找该点是否存在于最终VB中，如果存在存在，并且与该顶点完全相同，则不添加顶点，只添加Index;其他情况则添加顶点与Index;

### UE实现好处
快： 为了避免查找相临顶点的O(N^2)的时间开销，做了以下逐渐缩小求解空间的优化
1. 对Z值Hash来聚类，相当于把3维hash降到了一维，降低了问题的维度
2. 对于z值相同的顶点来说，先是对顶点的索引判断后再进行顶点相同的判断（顶点完全相同的判断很重！！），也就是把顶点是否判断给后推到了最后也就是问题快要到精确觖的时候才去做，大大减少了无关计算
